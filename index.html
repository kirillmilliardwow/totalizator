<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∞ –¢–æ—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä 2026 - –ö—Ç–æ —É–≤–æ–ª–∏—Ç—Å—è?</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --accent: #fd79a8;
            --success: #00b894;
            --warning: #fdcb6e;
            --danger: #e17055;
            --light: #f8f9fa;
            --dark: #2d3436;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        body {
            background: var(--bg-gradient);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .header {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            padding: 30px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: "üé∞ üèÜ üíº";
            position: absolute;
            font-size: 100px;
            opacity: 0.1;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            position: relative;
            z-index: 1;
        }
        
        .header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
            background: rgba(108, 92, 231, 0.1);
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: var(--dark);
            opacity: 0.7;
        }
        
        .game-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        @media (max-width: 900px) {
            .game-container {
                grid-template-columns: 1fr;
            }
        }
        
        .section {
            background: var(--light);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .section-title {
            color: var(--primary);
            font-size: 1.5em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--accent);
        }
        
        .token-display {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .token-display::before {
            content: "üí∞üéØüìä";
            position: absolute;
            font-size: 80px;
            opacity: 0.1;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .token-display h3 {
            font-size: 1.8em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        #tokensLeft {
            font-size: 2em;
            font-weight: bold;
            background: white;
            color: var(--primary);
            padding: 5px 20px;
            border-radius: 50px;
            display: inline-block;
            margin: 10px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .person-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 12px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            transition: all 0.3s;
            border-left: 5px solid var(--secondary);
        }
        
        .person-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left-color: var(--accent);
        }
        
        .person-info {
            flex-grow: 1;
        }
        
        .person-name {
            font-weight: bold;
            color: var(--dark);
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        
        .community-avg {
            font-size: 0.85em;
            color: var(--primary);
            opacity: 0.8;
        }
        
        .bet-input-container {
            position: relative;
        }
        
        .bet-input {
            width: 90px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            color: var(--primary);
            transition: all 0.3s;
            background: rgba(255,255,255,0.9);
        }
        
        .bet-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(253, 121, 168, 0.2);
            transform: scale(1.05);
        }
        
        .bet-input.changed {
            background: #e8f7ff;
            border-color: var(--primary);
            animation: pulse 0.5s;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .buttons-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }
        
        .btn {
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-primary {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(90deg, var(--success), #55efc4);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(90deg, var(--warning), #ffeaa7);
            color: var(--dark);
        }
        
        .btn-danger {
            background: linear-gradient(90deg, var(--danger), #fab1a0);
            color: white;
        }
        
        .btn-purple {
            background: linear-gradient(90deg, #a55eea, #dda0f3);
            color: white;
        }
        
        .leaderboard {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
            border-radius: 15px;
            background: white;
            padding: 15px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: var(--light);
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .leaderboard-item:hover {
            background: #e8f4fc;
            transform: translateX(5px);
        }
        
        .leaderboard-item.me {
            background: linear-gradient(90deg, #e8f4fc, #d6eaf8);
            border-left: 4px solid var(--primary);
        }
        
        .rank {
            width: 40px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .rank-1 { color: gold; }
        .rank-2 { color: silver; }
        .rank-3 { color: #cd7f32; }
        
        .user-info {
            flex-grow: 1;
            margin-left: 15px;
        }
        
        .user-name {
            font-weight: bold;
            color: var(--dark);
        }
        
        .user-bet {
            font-size: 0.9em;
            color: var(--primary);
        }
        
        .result-bar {
            height: 25px;
            background: #ecf0f1;
            border-radius: 15px;
            margin-top: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .result-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 15px;
            width: 0%;
            transition: width 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }
        
        .result-fill::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shine 2s infinite;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .comparison-chart {
            margin-top: 20px;
        }
        
        .comparison-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 10px;
        }
        
        .comparison-labels {
            display: flex;
            gap: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            padding: 0 15px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalAppear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes modalAppear {
            0% { transform: scale(0.7) translateY(50px); opacity: 0; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            color: var(--dark);
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .close-btn:hover {
            color: var(--danger);
        }
        
        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            pointer-events: none;
            z-index: 9999;
        }
        
        .emoji-animation {
            position: absolute;
            font-size: 30px;
            pointer-events: none;
            z-index: 9998;
            animation: floatUp 2s forwards;
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(0); opacity: 0; }
        }
        
        .footer {
            text-align: center;
            padding: 25px;
            background: rgba(108, 92, 231, 0.1);
            color: var(--dark);
            font-size: 0.9em;
            border-top: 1px solid rgba(108, 92, 231, 0.2);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideIn 0.5s, slideOut 0.5s 2.5s forwards;
            border-left: 5px solid var(--success);
            max-width: 400px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        .pacman-game {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #2d3436, #636e72);
            border-radius: 20px;
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .pacman-game::before {
            content: "üëæ üéÆ üëª";
            position: absolute;
            font-size: 80px;
            opacity: 0.1;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .game-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .game-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--dark);
            font-size: 1.2em;
        }
        
        .loading i {
            color: var(--primary);
            margin-right: 10px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <h1>üé∞ –¢–æ—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä 2026</h1>
            <div class="subtitle">–ö—Ç–æ –ø–µ—Ä–≤—ã–π —É–≤–æ–ª–∏—Ç—Å—è –≤ 2026 –≥–æ–¥—É? –°—Ç–∞–≤—å—Ç–µ –∂–µ—Ç–æ–Ω—ã –∏ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–º!</div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-value" id="totalBets">0</div>
                <div class="stat-label">üìä –í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="topCandidate">-</div>
                <div class="stat-label">üèÜ –õ–∏–¥–µ—Ä —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="yourPosition">-</div>
                <div class="stat-label">üë§ –í–∞—à–µ –º–µ—Å—Ç–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="activeUsers">1</div>
                <div class="stat-label">üë• –ò–≥—Ä–∞—é—Ç —Å–µ–π—á–∞—Å</div>
            </div>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="game-container">
            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –°—Ç–∞–≤–∫–∏ -->
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-money-bill-wave"></i>
                    –í–∞—à–∏ —Å—Ç–∞–≤–∫–∏
                </div>
                
                <div class="token-display">
                    <h3>–û—Å—Ç–∞–ª–æ—Å—å –∂–µ—Ç–æ–Ω–æ–≤</h3>
                    <div id="tokensLeft">100</div>
                    <div style="font-size: 0.9em; opacity: 0.9;">–ò–∑ 100 –≤–æ–∑–º–æ–∂–Ω—ã—Ö</div>
                </div>
                
                <div id="bettingArea">
                    <!-- –°–ø–∏—Å–æ–∫ –ª—é–¥–µ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∑–¥–µ—Å—å -->
                    <div class="loading">
                        <i class="fas fa-spinner"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤...
                    </div>
                </div>
                
                <div class="buttons-container">
                    <button class="btn btn-success" id="placeBet">
                        <i class="fas fa-check-circle"></i> –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É
                    </button>
                    <button class="btn btn-primary" id="randomBtn">
                        <i class="fas fa-random"></i> –°–ª—É—á–∞–π–Ω–æ
                    </button>
                    <button class="btn btn-danger" id="resetBtn">
                        <i class="fas fa-redo"></i> –°–±—Ä–æ—Å–∏—Ç—å
                    </button>
                    <button class="btn btn-purple" id="saveBtn" style="display: none;">
                        <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button class="btn btn-warning" id="shareBtn" style="display: none;">
                        <i class="fas fa-share-alt"></i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                    </button>
                </div>
                
                <!-- –ú–∏–Ω–∏-–∏–≥—Ä–∞ Pacman -->
                <div class="pacman-game">
                    <h3><i class="fas fa-gamepad"></i> –ú–∏–Ω–∏-–∏–≥—Ä–∞: Pacman Break</h3>
                    <p>–û—Ç–≤–ª–µ–∫–∏—Ç–µ—Å—å –æ—Ç —Å—Ç–∞–≤–æ–∫! –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –ü–∞–∫–º–∞–Ω–æ–º –∫–ª–∞–≤–∏—à–∞–º–∏ —Å—Ç—Ä–µ–ª–æ–∫</p>
                    <div style="margin: 20px 0; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                        <canvas id="pacmanCanvas" width="400" height="200" style="border-radius: 5px; background: #000;"></canvas>
                    </div>
                    <div class="game-controls">
                        <button class="game-btn" onclick="startPacman()">
                            <i class="fas fa-play"></i> –°—Ç–∞—Ä—Ç
                        </button>
                        <button class="game-btn" onclick="pausePacman()">
                            <i class="fas fa-pause"></i> –ü–∞—É–∑–∞
                        </button>
                        <button class="game-btn" onclick="resetPacman()">
                            <i class="fas fa-undo"></i> –ó–∞–Ω–æ–≤–æ
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ª–∏–¥–µ—Ä—ã -->
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-chart-line"></i>
                    –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ —Ä–µ–π—Ç–∏–Ω–≥
                </div>
                
                <div id="results" style="display: none;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–∞–≤–æ–∫</h3>
                    <div class="comparison-chart" id="resultsList">
                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                    </div>
                    
                    <div id="winnerAnnouncement" style="margin-top: 30px; padding: 20px; background: linear-gradient(90deg, rgba(108, 92, 231, 0.1), rgba(162, 155, 254, 0.1)); border-radius: 15px;">
                        <!-- –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è -->
                    </div>
                </div>
                
                <div id="noResults">
                    <p style="margin-bottom: 20px; font-size: 1.1em;">–°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å —Å –¥—Ä—É–≥–∏–º–∏!</p>
                    
                    <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;"><i class="fas fa-crown"></i> –¢–æ–ø-3 –ø–æ –≤–µ—Ä—Å–∏–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</h4>
                        <ol id="communityTop" style="list-style: none; padding-left: 0;">
                            <li style="padding: 10px 15px; margin-bottom: 8px; background: rgba(108, 92, 231, 0.1); border-radius: 8px;">–ó–∞–≥—Ä—É–∑–∫–∞...</li>
                        </ol>
                    </div>
                    
                    <button class="btn btn-primary" id="viewAllBtn" style="width: 100%;">
                        <i class="fas fa-users"></i> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å—Ç–∞–≤–∫–∏
                    </button>
                </div>
                
                <!-- –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ -->
                <div style="margin-top: 30px;">
                    <h3 class="section-title">
                        <i class="fas fa-trophy"></i>
                        –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤
                    </h3>
                    <div id="leaderboard" class="leaderboard">
                        <div class="loading">
                            <i class="fas fa-spinner"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –§—É—Ç–µ—Ä -->
        <div class="footer">
            <p>üéØ –≠—Ç–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –∏–≥—Ä–∞ –¥–ª—è —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è. –†–µ–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –æ–± —É—Ö–æ–¥–µ —Å —Ä–∞–±–æ—Ç—ã - —Å–ª–æ–∂–Ω—ã–µ –∏ –ª–∏—á–Ω—ã–µ.</p>
            <p>üìÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∏–º 31 –¥–µ–∫–∞–±—Ä—è 2026 –≥–æ–¥–∞! –£–¥–∞—á–∏ –≤ —Å—Ç–∞–≤–∫–∞—Ö! üçÄ</p>
            <p style="margin-top: 15px; font-size: 0.8em; opacity: 0.7;">
                <i class="fas fa-heart" style="color: var(--accent);"></i> 
                –°–æ–∑–¥–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –¥–ª—è –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ –≤—Ä–µ–º—è–ø—Ä–µ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è
            </p>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ –≤—Å–µ–º–∏ —Å—Ç–∞–≤–∫–∞–º–∏ -->
    <div id="allBetsModal" class="modal">
        <div class="modal-content">
            <div class="close-btn" onclick="closeModal()">&times;</div>
            <h2 style="color: var(--primary); margin-bottom: 20px;">
                <i class="fas fa-list-ol"></i> –í—Å–µ —Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
            </h2>
            <div id="allBetsList" style="max-height: 400px; overflow-y: auto;">
                <div class="loading">
                    <i class="fas fa-spinner"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å—Ç–∞–≤–æ–∫...
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø SUPABASE ==========
        const SUPABASE_URL = 'https://emsdxguafvggifztgeks.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_hhEWBsXgWr_TTC9rFp7Qfg_SfuD6bYl';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // –î–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        const people = [
            "–ü–æ–¥–≤–∞–ª–∫–æ–≤–∞", "–°–∞–ø—å—è–Ω–∞—è", "–ü–æ–ø–æ–≤", "–ë–∞–ª—ã–∫–∏–Ω–∞", "–ë–∏–ª–∏—á–µ–Ω–∫–æ", 
            "–ö—É–ª–∏–∫–æ–≤", "–î–µ–≥—Ç–µ—Ä–µ–≤–∞", "–¢—è–≥–∏–Ω–∞", "–ö–æ—Ä–æ–ª–µ–≤–∞", "–ñ–∏–ª–∫–æ", 
            "–¢—É—Ä–∫–∏–Ω–∞", "–ë—É—Ä–∫–æ–≤–∞", "–Æ—Ä—á–∏—Ö–∏–Ω–∞"
        ];

        // –ü—Ä–æ–≥–Ω–æ–∑ AI
        const aiPredictions = {
            "–ü–æ–¥–≤–∞–ª–∫–æ–≤–∞": 6, "–°–∞–ø—å—è–Ω–∞—è": 7, "–ü–æ–ø–æ–≤": 3, "–ë–∞–ª—ã–∫–∏–Ω–∞": 4,
            "–ë–∏–ª–∏—á–µ–Ω–∫–æ": 12, "–ö—É–ª–∏–∫–æ–≤": 10, "–î–µ–≥—Ç–µ—Ä–µ–≤–∞": 8, "–¢—è–≥–∏–Ω–∞": 7,
            "–ö–æ—Ä–æ–ª–µ–≤–∞": 7, "–ñ–∏–ª–∫–æ": 15, "–¢—É—Ä–∫–∏–Ω–∞": 9, "–ë—É—Ä–∫–æ–≤–∞": 8, "–Æ—Ä—á–∏—Ö–∏–Ω–∞": 4
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let userBets = {};
        let userName = '';
        let userId = '';
        let communityStats = {
            totalBets: 0,
            topCandidate: '',
            candidateStats: {},
            userCount: 0
        };
        
        // –ò–≥—Ä–∞ Pacman
        let pacmanGame = null;
        let pacmanInterval = null;

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        async function init() {
            console.log('üéÆ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞–≤–æ–∫
            const savedBets = localStorage.getItem('tot_user_bets');
            if (savedBets) {
                userBets = JSON.parse(savedBets);
            } else {
                people.forEach(person => userBets[person] = 0);
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            await getUserName();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App (–µ—Å–ª–∏ –µ—Å—Ç—å)
            initTelegram();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            await loadRealStats();
            
            // –†–µ–Ω–¥–µ—Ä–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            renderBettingArea();
            updateTokensLeft();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã Pacman
            initPacman();
            
            console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function getUserName() {
            userName = localStorage.getItem('tot_user_name');
            
            if (!userName) {
                // –ï—Å–ª–∏ –≤ Telegram, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ Telegram
                if (window.Telegram?.WebApp) {
                    const tg = window.Telegram.WebApp;
                    const user = tg.initDataUnsafe?.user;
                    if (user) {
                        userName = user.first_name || user.username || 'Telegram User';
                        userId = `tg_${user.id}`;
                    }
                }
                
                // –ï—Å–ª–∏ –Ω–µ –≤ Telegram –∏ –∏–º—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                if (!userName) {
                    setTimeout(() => {
                        const name = prompt("üë§ –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤:", 
                                          "–ò–≥—Ä–æ–∫_" + Math.floor(Math.random() * 1000));
                        if (name) {
                            userName = name;
                            localStorage.setItem('tot_user_name', userName);
                            showNotification(`üëã –ü—Ä–∏–≤–µ—Ç, ${userName}! –ì–æ—Ç–æ–≤—ã –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏?`);
                        }
                    }, 1000);
                }
            }
            
            // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç
            if (!userId) {
                userId = localStorage.getItem('tot_user_id');
                if (!userId) {
                    userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('tot_user_id', userId);
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
        function initTelegram() {
            if (window.Telegram?.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.expand();
                tg.enableClosingConfirmation();
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É
                if (tg.colorScheme === 'dark') {
                    document.body.style.background = '#1a1a2e';
                    document.querySelector('.container').style.background = 'rgba(45, 52, 54, 0.95)';
                    document.querySelector('.container').style.color = '#f8f9fa';
                }
            }
        }

        // ========== –†–ê–ë–û–¢–ê –° –ë–ê–ó–û–ô –î–ê–ù–ù–´–• ==========
        async function loadRealStats() {
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                document.getElementById('leaderboard').innerHTML = '<div class="loading"><i class="fas fa-spinner"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...</div>';
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Å—Ç–∞–≤–∫–∏
                const { data: bets, error: betsError } = await supabase
                    .from('bets')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (betsError) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–≤–æ–∫:', betsError);
                    throw betsError;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
                communityStats.totalBets = bets?.length || 0;
                communityStats.userCount = new Set(bets?.map(b => b.user_id)).size || 1;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                document.getElementById('totalBets').textContent = communityStats.totalBets;
                document.getElementById('activeUsers').textContent = communityStats.userCount;
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
                calculateCandidateStats(bets || []);
                
                // –°—Ç—Ä–æ–∏–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
                await buildLeaderboard(bets || []);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
                updateCommunityUI();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ —Å—Ç–∞–≤–∫–∏
                if (communityStats.totalBets > 0) {
                    const lastVisit = localStorage.getItem('last_visit_count') || 0;
                    if (communityStats.totalBets > lastVisit) {
                        const newBets = communityStats.totalBets - lastVisit;
                        if (newBets > 0) {
                            showNotification(`üìà –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${newBets} –Ω–æ–≤—ã—Ö —Å—Ç–∞–≤–æ–∫!`);
                        }
                    }
                    localStorage.setItem('last_visit_count', communityStats.totalBets);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                showNotification('‚ö†Ô∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ–º–æ-—Ä–µ–∂–∏–º');
                showDemoData();
            }
        }

        // –†–∞—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
        function calculateCandidateStats(bets) {
            const candidateTotals = {};
            const candidateCounts = {};
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
            people.forEach(person => {
                candidateTotals[person] = 0;
                candidateCounts[person] = 0;
            });
            
            // –°—É–º–º–∏—Ä—É–µ–º —Å—Ç–∞–≤–∫–∏
            bets.forEach(bet => {
                if (bet.bets) {
                    Object.keys(bet.bets).forEach(person => {
                        if (people.includes(person)) {
                            const value = bet.bets[person] || 0;
                            candidateTotals[person] += value;
                            if (value > 0) candidateCounts[person]++;
                        }
                    });
                }
            });
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
            communityStats.candidateStats = {};
            people.forEach(person => {
                const count = candidateCounts[person];
                communityStats.candidateStats[person] = count > 0 ? 
                    Math.round(candidateTotals[person] / count) : 0;
            });
            
            // –ù–∞—Ö–æ–¥–∏–º –ª–∏–¥–µ—Ä–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
            let topCandidate = '';
            let maxVotes = 0;
            
            bets.forEach(bet => {
                if (bet.top_choice) {
                    const candidate = bet.top_choice;
                    if (!candidateCounts[candidate]) candidateCounts[candidate] = 0;
                    candidateCounts[candidate]++;
                    if (candidateCounts[candidate] > maxVotes) {
                        maxVotes = candidateCounts[candidate];
                        topCandidate = candidate;
                    }
                }
            });
            
            communityStats.topCandidate = topCandidate || "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö";
            document.getElementById('topCandidate').textContent = topCandidate || "-";
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
        async function saveBetToDatabase() {
            const usedTokens = Object.values(userBets).reduce((a, b) => a + b, 0);
            
            if (usedTokens !== 100) {
                alert("‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤—Å–µ 100 –∂–µ—Ç–æ–Ω–æ–≤!");
                return false;
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–ª–∞–≤–Ω—ã–π –≤—ã–±–æ—Ä
            let topChoice = '';
            let maxBet = 0;
            Object.keys(userBets).forEach(person => {
                if (userBets[person] > maxBet) {
                    maxBet = userBets[person];
                    topChoice = person;
                }
            });
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ—á–∫–∏
            const score = Math.floor(maxBet * 1.5 + Math.random() * 20);
            
            try {
                const betData = {
                    user_id: userId,
                    user_name: userName || '–ê–Ω–æ–Ω–∏–º–Ω—ã–π –∏–≥—Ä–æ–∫',
                    bets: userBets,
                    top_choice: topChoice,
                    total_score: score,
                    created_at: new Date().toISOString()
                };
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç–∞–≤–∫—É
                const { data: existingBet } = await supabase
                    .from('bets')
                    .select('id')
                    .eq('user_id', userId)
                    .maybeSingle();
                
                let result;
                if (existingBet) {
                    result = await supabase
                        .from('bets')
                        .update(betData)
                        .eq('user_id', userId);
                } else {
                    result = await supabase
                        .from('bets')
                        .insert([betData]);
                }
                
                if (result.error) throw result.error;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                createConfetti();
                showNotification('‚úÖ –°—Ç–∞–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                localStorage.setItem('tot_user_bets', JSON.stringify(userBets));
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                setTimeout(() => loadRealStats(), 1500);
                
                return true;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏');
                return false;
            }
        }

        // ========== –§–£–ù–ö–¶–ò–ò UI ==========
        function renderBettingArea() {
            const bettingArea = document.getElementById('bettingArea');
            bettingArea.innerHTML = '';
            
            people.forEach((person, index) => {
                const communityAvg = communityStats.candidateStats?.[person] || 0;
                const currentBet = userBets[person] || 0;
                
                const card = document.createElement('div');
                card.className = 'person-card';
                card.style.animationDelay = `${index * 0.05}s`;
                card.style.animation = 'slideIn 0.5s ease-out forwards';
                card.style.opacity = '0';
                
                // –≠–º–æ–¥–∑–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
                const emojis = ['üëë', 'üíº', 'üìä', 'üéØ', 'üí∞', 'üèÜ', '‚≠ê', 'üî•', 'üöÄ', 'üíé', 'üëî', 'üìà', 'üé©'];
                const emoji = emojis[index % emojis.length];
                
                card.innerHTML = `
                    <div class="person-info">
                        <div class="person-name">${emoji} ${person}</div>
                        <div class="community-avg">
                            <i class="fas fa-users"></i> –°–æ–æ–±—â–µ—Å—Ç–≤–æ: ${communityAvg}%
                        </div>
                    </div>
                    <div class="bet-input-container">
                        <input type="number" 
                               min="0" 
                               max="100" 
                               value="${currentBet}"
                               class="bet-input ${currentBet > 0 ? 'changed' : ''}"
                               data-person="${person}"
                               oninput="updateBet('${person}', this.value)"
                               onfocus="this.select()">
                    </div>
                `;
                
                bettingArea.appendChild(card);
            });
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
            setTimeout(() => {
                document.querySelectorAll('.person-card').forEach((card, i) => {
                    card.style.animation = `slideIn 0.5s ${i * 0.05}s ease-out forwards`;
                });
            }, 100);
        }

        function updateBet(person, value) {
            const numValue = parseInt(value) || 0;
            const currentTotal = Object.values(userBets).reduce((a, b) => a + b, 0);
            const newTotal = currentTotal - (userBets[person] || 0) + numValue;
            
            if (newTotal > 100) {
                const available = 100 - (currentTotal - (userBets[person] || 0));
                alert(`üéØ –ù–µ–ª—å–∑—è –ø–æ—Å—Ç–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ 100 –∂–µ—Ç–æ–Ω–æ–≤! –î–æ—Å—Ç—É–ø–Ω–æ: ${available}`);
                const input = document.querySelector(`[data-person="${person}"]`);
                input.value = userBets[person] || 0;
                return;
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
            const input = document.querySelector(`[data-person="${person}"]`);
            input.classList.add('changed');
            setTimeout(() => input.classList.remove('changed'), 500);
            
            // –°–æ–∑–¥–∞–µ–º —ç–º–æ–¥–∑–∏ –∞–Ω–∏–º–∞—Ü–∏—é
            if (numValue > (userBets[person] || 0)) {
                createEmojiAnimation(input, 'üí∞');
            }
            
            userBets[person] = numValue < 0 ? 0 : numValue;
            updateTokensLeft();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            document.getElementById('saveBtn').style.display = 'flex';
            document.getElementById('shareBtn').style.display = 'flex';
        }

        function updateTokensLeft() {
            const usedTokens = Object.values(userBets).reduce((a, b) => a + b, 0);
            const totalTokens = 100 - usedTokens;
            const tokenElement = document.getElementById('tokensLeft');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
            tokenElement.style.transform = 'scale(1.2)';
            setTimeout(() => tokenElement.style.transform = 'scale(1)', 300);
            
            tokenElement.textContent = totalTokens;
            
            // –ò–∑–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—Å—Ç–∞—Ç–∫–∞
            if (totalTokens < 20) {
                tokenElement.style.color = '#e74c3c';
                tokenElement.style.background = '#ffeaa7';
            } else if (totalTokens < 50) {
                tokenElement.style.color = '#f39c12';
                tokenElement.style.background = '#fff9e6';
            } else {
                tokenElement.style.color = '#6c5ce7';
                tokenElement.style.background = 'white';
            }
        }

        function buildLeaderboard(bets) {
            const leaderboardElement = document.getElementById('leaderboard');
            
            if (!bets || bets.length === 0) {
                leaderboardElement.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-trophy" style="font-size: 3em; color: #ddd; margin-bottom: 15px;"></i>
                        <p>–ï—â–µ –Ω–µ—Ç —Å—Ç–∞–≤–æ–∫. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º! üèÜ</p>
                    </div>
                `;
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ—á–∫–∞–º
            const sortedBets = [...bets].sort((a, b) => b.total_score - a.total_score);
            
            let html = '';
            let myPosition = 0;
            
            sortedBets.slice(0, 10).forEach((bet, index) => {
                const isMe = bet.user_id === userId;
                const rankClass = index === 0 ? 'rank-1' : 
                                index === 1 ? 'rank-2' : 
                                index === 2 ? 'rank-3' : '';
                
                if (isMe) myPosition = index + 1;
                
                // –≠–º–æ–¥–∑–∏ –¥–ª—è —Ä–∞–Ω–≥–æ–≤
                const rankEmojis = ['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£', '6Ô∏è‚É£', '7Ô∏è‚É£', '8Ô∏è‚É£', '9Ô∏è‚É£', 'üîü'];
                const rankEmoji = rankEmojis[index] || `${index + 1}.`;
                
                html += `
                    <div class="leaderboard-item ${isMe ? 'me' : ''}">
                        <div class="rank ${rankClass}">${rankEmoji}</div>
                        <div class="user-info">
                            <div class="user-name">
                                ${bet.user_name || '–ê–Ω–æ–Ω–∏–º'} 
                                ${isMe ? ' <i class="fas fa-user" style="color: #6c5ce7;"></i>' : ''}
                            </div>
                            <div class="user-bet">
                                <i class="fas fa-chart-pie"></i> 
                                ${bet.top_choice}: ${bet.bets ? (bet.bets[bet.top_choice] || 0) : 0}%
                            </div>
                        </div>
                    </div>
                `;
            });
            
            leaderboardElement.innerHTML = html;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const yourPositionElement = document.getElementById('yourPosition');
            if (myPosition > 0) {
                yourPositionElement.textContent = `${myPosition} –º–µ—Å—Ç–æ`;
                yourPositionElement.style.color = myPosition <= 3 ? '#e74c3c' : '#6c5ce7';
            } else if (Object.values(userBets).some(bet => bet > 0)) {
                yourPositionElement.textContent = "–ù–µ –≤ —Ç–æ–ø-10";
                yourPositionElement.style.color = '#95a5a6';
            } else {
                yourPositionElement.textContent = "-";
            }
        }

        function showResults() {
            const usedTokens = Object.values(userBets).reduce((a, b) => a + b, 0);
            
            if (usedTokens !== 100) {
                alert(`üéØ –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤—Å–µ 100 –∂–µ—Ç–æ–Ω–æ–≤! –í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ ${usedTokens} –∏–∑ 100.`);
                return;
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            let maxBet = 0;
            let winners = [];
            
            Object.keys(userBets).forEach(person => {
                if (userBets[person] > maxBet) {
                    maxBet = userBets[person];
                    winners = [person];
                } else if (userBets[person] === maxBet && maxBet > 0) {
                    winners.push(person);
                }
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º
            const sortedPeople = [...people].sort((a, b) => userBets[b] - userBets[a]);
            
            // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '';
            
            sortedPeople.forEach((person, index) => {
                const userBet = userBets[person];
                const aiBet = aiPredictions[person];
                const communityBet = Math.round(communityStats.candidateStats?.[person] || 0);
                
                // –≠–º–æ–¥–∑–∏ –¥–ª—è —Ç–æ–ø-3
                const rankEmojis = ['ü•á', 'ü•à', 'ü•â'];
                const rankEmoji = rankEmojis[index] || `${index + 1}.`;
                
                const row = document.createElement('div');
                row.className = 'comparison-row';
                row.innerHTML = `
                    <div style="flex: 1;">
                        <strong>${rankEmoji} ${person}</strong>
                        <div class="result-bar">
                            <div class="result-fill" style="width: 0%" data-width="${userBet}"></div>
                        </div>
                    </div>
                    <div style="text-align: right; min-width: 200px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="color: #6c5ce7;"><i class="fas fa-user"></i> –í—ã: ${userBet}%</span>
                            <span style="color: #fd79a8;"><i class="fas fa-robot"></i> AI: ${aiBet}%</span>
                            <span style="color: #00b894;"><i class="fas fa-users"></i> –°–æ–æ–±—â–µ—Å—Ç–≤–æ: ${communityBet}%</span>
                        </div>
                    </div>
                `;
                
                resultsList.appendChild(row);
            });
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª–æ—Å
            setTimeout(() => {
                document.querySelectorAll('.result-fill').forEach(fill => {
                    const width = fill.getAttribute('data-width');
                    fill.style.width = width + '%';
                });
            }, 300);
            
            // –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            const winnerAnnouncement = document.getElementById('winnerAnnouncement');
            if (winners.length > 0 && maxBet > 0) {
                if (winners.length === 1) {
                    winnerAnnouncement.innerHTML = `
                        <h3 style="color: #6c5ce7; margin-bottom: 10px;">üéâ –ü–æ –≤–∞—à–∏–º —Å—Ç–∞–≤–∫–∞–º –ø–µ—Ä–≤—ã–º —É–≤–æ–ª–∏—Ç—Å—è: <strong>${winners[0]}</strong></h3>
                        <div style="display: flex; gap: 20px;">
                            <div><i class="fas fa-robot"></i> AI —Å–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ ${aiPredictions[winners[0]]}%</div>
                            <div><i class="fas fa-users"></i> –°–æ–æ–±—â–µ—Å—Ç–≤–æ —Å—Ç–∞–≤–∏—Ç: ${Math.round(communityStats.candidateStats?.[winners[0]] || 0)}%</div>
                        </div>
                        <button onclick="shareResults()" style="margin-top: 15px; width: 100%;" class="btn btn-success">
                            <i class="fas fa-share-alt"></i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
                        </button>
                    `;
                } else {
                    winnerAnnouncement.innerHTML = `
                        <h3 style="color: #6c5ce7; margin-bottom: 10px;">üéâ –ü–æ –≤–∞—à–∏–º —Å—Ç–∞–≤–∫–∞–º –ø–µ—Ä–≤—ã–º–∏ –º–æ–≥—É—Ç —É–≤–æ–ª–∏—Ç—å—Å—è: <strong>${winners.join(', ')}</strong></h3>
                        <p>–£ –≤–∞—Å –Ω–∏—á—å—è! üèÜüèÜ</p>
                    `;
                }
                
                // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –¥–ª—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
                createConfetti();
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            document.getElementById('results').style.display = 'block';
            document.getElementById('noResults').style.display = 'none';
        }

        function updateCommunityUI() {
            const communityTop = document.getElementById('communityTop');
            if (communityStats.candidateStats && Object.keys(communityStats.candidateStats).length > 0) {
                const sortedCandidates = Object.entries(communityStats.candidateStats)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3);
                
                const rankEmojis = ['ü•á', 'ü•à', 'ü•â'];
                
                communityTop.innerHTML = sortedCandidates
                    .map(([name, percentage], i) => `
                        <li style="padding: 12px 15px; margin-bottom: 10px; background: ${i === 0 ? 'rgba(255, 215, 0, 0.1)' : i === 1 ? 'rgba(192, 192, 192, 0.1)' : 'rgba(205, 127, 50, 0.1)'}; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <span style="font-weight: bold;">${rankEmojis[i]} ${name}</span>
                            </div>
                            <div style="font-weight: bold; color: #6c5ce7;">
                                ${percentage}%
                            </div>
                        </li>
                    `)
                    .join('');
            } else {
                communityTop.innerHTML = '<li>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å—Ç–∞–≤–∫–∞—Ö —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</li>';
            }
        }

        function showDemoData() {
            communityStats.totalBets = 42;
            communityStats.topCandidate = "–ñ–∏–ª–∫–æ";
            communityStats.userCount = 15;
            
            document.getElementById('totalBets').textContent = '42';
            document.getElementById('topCandidate').textContent = '–ñ–∏–ª–∫–æ';
            document.getElementById('activeUsers').textContent = '15';
            
            // –î–µ–º–æ —Ç–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤
            const demoLeaderboard = [
                { user_name: '–ê–ª–µ–∫—Å–µ–π üèÜ', top_choice: '–ñ–∏–ª–∫–æ', bets: { '–ñ–∏–ª–∫–æ': 25 } },
                { user_name: '–ú–∞—Ä–∏—è ‚≠ê', top_choice: '–ë–∏–ª–∏—á–µ–Ω–∫–æ', bets: { '–ë–∏–ª–∏—á–µ–Ω–∫–æ': 22 } },
                { user_name: '–î–º–∏—Ç—Ä–∏–π üî•', top_choice: '–ö—É–ª–∏–∫–æ–≤', bets: { '–ö—É–ª–∏–∫–æ–≤': 20 } },
                { user_name: '–ê–Ω–Ω–∞ üíé', top_choice: '–¢—É—Ä–∫–∏–Ω–∞', bets: { '–¢—É—Ä–∫–∏–Ω–∞': 18 } },
                { user_name: '–°–µ—Ä–≥–µ–π üöÄ', top_choice: '–î–µ–≥—Ç–µ—Ä–µ–≤–∞', bets: { '–î–µ–≥—Ç–µ—Ä–µ–≤–∞': 15 } }
            ];
            
            const leaderboardElement = document.getElementById('leaderboard');
            let html = '';
            
            demoLeaderboard.forEach((bet, index) => {
                const rankEmojis = ['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£'];
                html += `
                    <div class="leaderboard-item">
                        <div class="rank ${index < 3 ? `rank-${index + 1}` : ''}">${rankEmojis[index]}</div>
                        <div class="user-info">
                            <div class="user-name">${bet.user_name}</div>
                            <div class="user-bet">
                                <i class="fas fa-chart-pie"></i> 
                                ${bet.top_choice}: ${bet.bets[bet.top_choice]}%
                            </div>
                        </div>
                    </div>
                `;
            });
            
            leaderboardElement.innerHTML = html;
        }

        // ========== –ê–ù–ò–ú–ê–¶–ò–ò –ò –≠–§–§–ï–ö–¢–´ ==========
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <i class="fas fa-bell" style="color: #6c5ce7; font-size: 1.5em;"></i>
                <div>${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function createConfetti() {
            const colors = ['#6c5ce7', '#fd79a8', '#00b894', '#fdcb6e', '#e17055', '#a29bfe'];
            const emojis = ['üéâ', 'üéä', 'ü•≥', 'üéØ', 'üèÜ', 'üí∞', 'üé∞', 'üçÄ'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.innerHTML = emojis[Math.floor(Math.random() * emojis.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-20px';
                confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.fontSize = Math.random() * 20 + 15 + 'px';
                confetti.style.position = 'fixed';
                confetti.style.zIndex = '9999';
                
                document.body.appendChild(confetti);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è
                const animation = confetti.animate([
                    { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                    { transform: `translateY(${window.innerHeight}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                ], {
                    duration: Math.random() * 2000 + 1000,
                    easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
                });
                
                animation.onfinish = () => confetti.remove();
            }
        }

        function createEmojiAnimation(element, emoji) {
            const animation = document.createElement('div');
            animation.className = 'emoji-animation';
            animation.innerHTML = emoji;
            animation.style.left = element.getBoundingClientRect().left + 'px';
            animation.style.top = element.getBoundingClientRect().top + 'px';
            
            document.body.appendChild(animation);
            
            setTimeout(() => {
                animation.remove();
            }, 2000);
        }

        // ========== –ò–ì–†–ê PACMAN ==========
        function initPacman() {
            const canvas = document.getElementById('pacmanCanvas');
            const ctx = canvas.getContext('2d');
            
            pacmanGame = {
                canvas: canvas,
                ctx: ctx,
                pacman: { x: 50, y: 100, radius: 15, speed: 3, direction: 0, mouth: 0.5 },
                dots: [],
                score: 0,
                running: false,
                keys: {}
            };
            
            // –°–æ–∑–¥–∞–µ–º —Ç–æ—á–∫–∏
            for (let i = 0; i < 20; i++) {
                pacmanGame.dots.push({
                    x: Math.random() * (canvas.width - 20) + 10,
                    y: Math.random() * (canvas.height - 20) + 10,
                    radius: 5,
                    active: true
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à
            document.addEventListener('keydown', (e) => {
                pacmanGame.keys[e.key] = true;
            });
            
            document.addEventListener('keyup', (e) => {
                pacmanGame.keys[e.key] = false;
            });
            
            // –†–∏—Å—É–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            drawPacman();
        }

        function drawPacman() {
            const { ctx, canvas, pacman, dots, score } = pacmanGame;
            
            // –û—á–∏—â–∞–µ–º —Ö–æ–ª—Å—Ç
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º —Ñ–æ–Ω
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º —Ç–æ—á–∫–∏
            dots.forEach(dot => {
                if (dot.active) {
                    ctx.fillStyle = '#FFD700';
                    ctx.beginPath();
                    ctx.arc(dot.x, dot.y, dot.radius, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
            
            // –†–∏—Å—É–µ–º –ü–∞–∫–º–∞–Ω–∞
            ctx.fillStyle = '#FF0';
            ctx.beginPath();
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Ä—Ç–∞
            pacman.mouth = (pacman.mouth + 0.1) % 1;
            const mouthAngle = 0.2 + Math.sin(pacman.mouth * Math.PI) * 0.3;
            
            ctx.arc(pacman.x, pacman.y, pacman.radius, 
                   pacman.direction + mouthAngle, 
                   pacman.direction + Math.PI * 2 - mouthAngle);
            ctx.lineTo(pacman.x, pacman.y);
            ctx.fill();
            
            // –†–∏—Å—É–µ–º —Å—á–µ—Ç
            ctx.fillStyle = '#FFF';
            ctx.font = '16px Arial';
            ctx.fillText(`–°—á–µ—Ç: ${score}`, 10, 20);
            
            // –†–∏—Å—É–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            ctx.font = '12px Arial';
            ctx.fillText('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: —Å—Ç—Ä–µ–ª–∫–∏ ‚Üê‚Üë‚Üí‚Üì', 10, canvas.height - 10);
        }

        function updatePacman() {
            if (!pacmanGame.running) return;
            
            const { pacman, dots, canvas } = pacmanGame;
            
            // –î–≤–∏–∂–µ–Ω–∏–µ –ü–∞–∫–º–∞–Ω–∞
            if (pacmanGame.keys['ArrowUp'] || pacmanGame.keys['w']) {
                pacman.y -= pacman.speed;
                pacman.direction = -Math.PI / 2;
            }
            if (pacmanGame.keys['ArrowDown'] || pacmanGame.keys['s']) {
                pacman.y += pacman.speed;
                pacman.direction = Math.PI / 2;
            }
            if (pacmanGame.keys['ArrowLeft'] || pacmanGame.keys['a']) {
                pacman.x -= pacman.speed;
                pacman.direction = Math.PI;
            }
            if (pacmanGame.keys['ArrowRight'] || pacmanGame.keys['d']) {
                pacman.x += pacman.speed;
                pacman.direction = 0;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü
            if (pacman.x < pacman.radius) pacman.x = pacman.radius;
            if (pacman.x > canvas.width - pacman.radius) pacman.x = canvas.width - pacman.radius;
            if (pacman.y < pacman.radius) pacman.y = pacman.radius;
            if (pacman.y > canvas.height - pacman.radius) pacman.y = canvas.height - pacman.radius;
            
            // –°–±–æ—Ä —Ç–æ—á–µ–∫
            dots.forEach((dot, index) => {
                if (dot.active) {
                    const dx = pacman.x - dot.x;
                    const dy = pacman.y - dot.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < pacman.radius + dot.radius) {
                        dot.active = false;
                        pacmanGame.score += 10;
                        
                        // –ê–Ω–∏–º–∞—Ü–∏—è —Å–±–æ—Ä–∞ —Ç–æ—á–∫–∏
                        createEmojiAnimation(
                            { getBoundingClientRect: () => ({ left: 100, top: 100 }) },
                            'üí∞'
                        );
                    }
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É
            if (dots.every(dot => !dot.active)) {
                pacmanGame.running = false;
                showNotification('üéâ –í—ã —Å–æ–±—Ä–∞–ª–∏ –≤—Å–µ —Ç–æ—á–∫–∏! –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!');
            }
            
            drawPacman();
        }

        function startPacman() {
            if (!pacmanGame.running) {
                pacmanGame.running = true;
                pacmanInterval = setInterval(updatePacman, 1000/60);
                showNotification('üëæ –ò–≥—Ä–∞ Pacman –Ω–∞—á–∞–ª–∞—Å—å! –£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∞–º–∏');
            }
        }

        function pausePacman() {
            pacmanGame.running = false;
            if (pacmanInterval) {
                clearInterval(pacmanInterval);
            }
        }

        function resetPacman() {
            pausePacman();
            initPacman();
            showNotification('üîÑ –ò–≥—Ä–∞ Pacman —Å–±—Ä–æ—à–µ–Ω–∞');
        }

        // ========== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ==========
        function openModal() {
            document.getElementById('allBetsModal').style.display = 'flex';
            loadAllBets();
        }

        function closeModal() {
            document.getElementById('allBetsModal').style.display = 'none';
        }

        async function loadAllBets() {
            try {
                const { data: bets, error } = await supabase
                    .from('bets')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                const allBetsList = document.getElementById('allBetsList');
                
                if (!bets || bets.length === 0) {
                    allBetsList.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <i class="fas fa-inbox" style="font-size: 3em; color: #ddd;"></i>
                            <p style="margin-top: 15px;">–ï—â–µ –Ω–µ—Ç —Å—Ç–∞–≤–æ–∫</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '<div style="display: flex; flex-direction: column; gap: 10px;">';
                
                bets.forEach(bet => {
                    const date = new Date(bet.created_at).toLocaleDateString('ru-RU', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    const isMe = bet.user_id === userId;
                    
                    html += `
                        <div style="padding: 15px; background: ${isMe ? '#e8f4fc' : '#f8f9fa'}; border-radius: 10px; border-left: 4px solid ${isMe ? '#6c5ce7' : '#ddd'};">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>${bet.user_name || '–ê–Ω–æ–Ω–∏–º'} ${isMe ? ' (–í—ã) üë§' : ''}</strong>
                                    <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                                        <i class="far fa-clock"></i> ${date}
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: bold; color: #6c5ce7;">${bet.top_choice}: ${bet.bets[bet.top_choice]}%</div>
                                    <div style="font-size: 0.9em; color: #666;">–û—á–∫–∏: ${bet.total_score}</div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                allBetsList.innerHTML = html;
            } catch (error) {
                allBetsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #e74c3c;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p style="margin-top: 15px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–≤–æ–∫</p>
                    </div>
                `;
            }
        }

        // ========== –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function shareResults() {
            const sorted = [...people].sort((a, b) => userBets[b] - userBets[a]);
            const top3 = sorted.slice(0, 3);
            
            const shareText = `üé∞ –ú–æ–π –ø—Ä–æ–≥–Ω–æ–∑, –∫—Ç–æ —É–≤–æ–ª–∏—Ç—Å—è –≤ 2026:\n\n` +
                             `ü•á ${top3[0]}: ${userBets[top3[0]]}%\n` +
                             `ü•à ${top3[1]}: ${userBets[top3[1]]}%\n` +
                             `ü•â ${top3[2]}: ${userBets[top3[2]]}%\n\n` +
                             `–í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫: ${communityStats.totalBets}\n` +
                             `–õ–∏–¥–µ—Ä —Å–æ–æ–±—â–µ—Å—Ç–≤–∞: ${communityStats.topCandidate}\n\n` +
                             `–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å: ${window.location.href}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'üéØ –ú–æ–π –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è –≤ 2026',
                    text: shareText,
                    url: window.location.href
                });
            } else if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.sendData(JSON.stringify({
                    action: 'share',
                    text: shareText
                }));
            } else {
                navigator.clipboard.writeText(shareText + '\n\n' + window.location.href);
                showNotification('üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            }
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï ==========
        document.addEventListener('DOMContentLoaded', () => {
            init();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            document.getElementById('placeBet').addEventListener('click', async () => {
                const usedTokens = Object.values(userBets).reduce((a, b) => a + b, 0);
                if (usedTokens !== 100) {
                    showNotification('üéØ –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤—Å–µ 100 –∂–µ—Ç–æ–Ω–æ–≤!');
                    return;
                }
                
                const saved = await saveBetToDatabase();
                if (saved) {
                    setTimeout(() => showResults(), 1000);
                }
            });
            
            document.getElementById('randomBtn').addEventListener('click', () => {
                // –ê–Ω–∏–º–∞—Ü–∏—è
                createEmojiAnimation(document.getElementById('randomBtn'), 'üé≤');
                
                people.forEach(person => userBets[person] = 0);
                
                let tokensLeft = 100;
                const shuffledPeople = [...people].sort(() => Math.random() - 0.5);
                
                for (let i = 0; i < shuffledPeople.length - 1; i++) {
                    if (tokensLeft <= 0) break;
                    
                    if (i === shuffledPeople.length - 2) {
                        userBets[shuffledPeople[i]] = tokensLeft;
                        break;
                    }
                    
                    const maxForThisPerson = Math.min(Math.floor(tokensLeft / 2) + 1, tokensLeft);
                    const randomBet = Math.floor(Math.random() * maxForThisPerson);
                    userBets[shuffledPeople[i]] = randomBet;
                    tokensLeft -= randomBet;
                }
                
                renderBettingArea();
                updateTokensLeft();
                document.getElementById('saveBtn').style.display = 'flex';
                document.getElementById('shareBtn').style.display = 'flex';
                
                showNotification('üé≤ –°—Ç–∞–≤–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Å–ª—É—á–∞–π–Ω–æ!');
            });
            
            document.getElementById('resetBtn').addEventListener('click', () => {
                if (confirm("üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Å—Ç–∞–≤–∫–∏?")) {
                    people.forEach(person => userBets[person] = 0);
                    renderBettingArea();
                    updateTokensLeft();
                    document.getElementById('results').style.display = 'none';
                    document.getElementById('noResults').style.display = 'block';
                    document.getElementById('saveBtn').style.display = 'none';
                    document.getElementById('shareBtn').style.display = 'none';
                    
                    showNotification('üîÑ –í—Å–µ —Å—Ç–∞–≤–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã');
                }
            });
            
            document.getElementById('saveBtn').addEventListener('click', saveBetToDatabase);
            document.getElementById('shareBtn').addEventListener('click', shareResults);
            document.getElementById('viewAllBtn').addEventListener('click', openModal);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(() => {
                loadRealStats();
            }, 30000);
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        window.onclick = function(event) {
            const modal = document.getElementById('allBetsModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
