<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–æ—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä: –ö—Ç–æ —É–≤–æ–ª–∏—Ç—Å—è –≤ 2026?</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
            margin-top: 20px;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .game-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 768px) {
            .game-area {
                grid-template-columns: 1fr;
            }
        }
        
        .betting-section, .results-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #e9ecef;
        }
        
        h2 {
            color: #3498db;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 0;
        }
        
        .total-tokens {
            background: #3498db;
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.3em;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .token-info {
            font-size: 0.9em;
            color: #7f8c8d;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .person-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        
        .person-row:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .person-name {
            font-weight: 600;
            color: #2c3e50;
            flex-grow: 1;
        }
        
        .bet-input {
            width: 80px;
            padding: 8px 12px;
            border: 2px solid #dfe6e9;
            border-radius: 6px;
            text-align: center;
            font-size: 1em;
            font-weight: bold;
            color: #2c3e50;
            transition: border-color 0.3s;
        }
        
        .bet-input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 25px;
            justify-content: center;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 180px;
        }
        
        #placeBet {
            background: #2ecc71;
            color: white;
        }
        
        #placeBet:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }
        
        #resetBtn {
            background: #e74c3c;
            color: white;
        }
        
        #resetBtn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        #randomBtn {
            background: #9b59b6;
            color: white;
        }
        
        #randomBtn:hover {
            background: #8e44ad;
            transform: translateY(-2px);
        }
        
        #saveBtn {
            background: #1abc9c;
            color: white;
        }
        
        #saveBtn:hover {
            background: #16a085;
            transform: translateY(-2px);
        }
        
        #shareBtn {
            background: #3498db;
            color: white;
        }
        
        #shareBtn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .leader {
            background: #fff9e6;
            border-left: 4px solid #f1c40f;
        }
        
        .prob-bar {
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .prob-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 10px;
            width: 0%;
            transition: width 1s ease-out;
        }
        
        .your-bet {
            font-weight: bold;
            color: #3498db;
        }
        
        .ai-bet {
            font-weight: bold;
            color: #e74c3c;
        }
        
        .community-bet {
            font-weight: bold;
            color: #9b59b6;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .hidden {
            display: none;
        }
        
        #results {
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .winner {
            background: #e8f6f3;
            border: 2px solid #1abc9c;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(26, 188, 156, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(26, 188, 156, 0); }
            100% { box-shadow: 0 0 0 0 rgba(26, 188, 156, 0); }
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 0.9em;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
        }
        
        .leaderboard {
            margin-top: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            margin-bottom: 8px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid transparent;
        }
        
        .leaderboard-item.me {
            border-left-color: #3498db;
            background: #e8f4fc;
        }
        
        .rank {
            font-weight: bold;
            width: 30px;
            text-align: center;
        }
        
        .rank-1 { color: gold; font-size: 1.2em; }
        .rank-2 { color: silver; font-size: 1.1em; }
        .rank-3 { color: #cd7f32; }
        
        .user-name {
            flex-grow: 1;
            margin-left: 10px;
        }
        
        .user-bet {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }
        
        .refresh-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .community-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .community-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        
        .candidate-avg {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-top: 3px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            margin-left: 5px;
        }
        
        .status-live {
            background: #e8f6f3;
            color: #1abc9c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÜ –¢–æ—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä 2026 <span class="status-badge status-live">LIVE</span></h1>
        <div class="subtitle">–ö—Ç–æ –ø–µ—Ä–≤—ã–π —É–≤–æ–ª–∏—Ç—Å—è –≤ 2026? –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ 100 –∂–µ—Ç–æ–Ω–æ–≤!</div>
        
        <div class="total-tokens">
            <div>–û—Å—Ç–∞–ª–æ—Å—å –∂–µ—Ç–æ–Ω–æ–≤: <span id="tokensLeft">100</span></div>
            <div style="font-size: 0.9em; margin-top: 8px;">
                üìä –í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫: <span id="totalBets">0</span> 
                <button onclick="loadRealStats()" class="refresh-btn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
        </div>
        
        <div class="token-info">–ß–µ–º –±–æ–ª—å—à–µ –∂–µ—Ç–æ–Ω–æ–≤ ‚Äî —Ç–µ–º –≤—ã—à–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–≤–æ–ª—å–Ω–µ–Ω–∏—è –ø–æ –≤–∞—à–µ–º—É –º–Ω–µ–Ω–∏—é</div>
        
        <div class="game-area">
            <div class="betting-section">
                <h2>–í–∞—à–∏ —Å—Ç–∞–≤–∫–∏</h2>
                <div id="bettingArea"></div>
                
                <div class="buttons">
                    <button id="placeBet">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
                    <button id="randomBtn">–°–ª—É—á–∞–π–Ω–æ–µ</button>
                    <button id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å</button>
                    <button id="saveBtn" class="hidden">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button id="shareBtn" class="hidden">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                </div>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ -->
                <div class="stats" id="realStats">
                    <div class="stat-box">
                        <div class="stat-value" id="realTotalBets">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="topCandidate">-</div>
                        <div class="stat-label">–õ–∏–¥–µ—Ä —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="yourPosition">-</div>
                        <div class="stat-label">–í–∞—à–µ –º–µ—Å—Ç–æ</div>
                    </div>
                </div>
                
                <!-- –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ -->
                <div style="margin-top: 20px;">
                    <h3>üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h3>
                    <div id="leaderboard" class="leaderboard">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...</div>
                    </div>
                </div>
            </div>
            
            <div class="results-section">
                <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
                <div id="results" class="hidden">
                    <div class="result-header">
                        <span>–£—á–∞—Å—Ç–Ω–∏–∫</span>
                        <span>–í—ã / AI / –°–æ–æ–±—â–µ—Å—Ç–≤–æ</span>
                    </div>
                    <div id="resultsList"></div>
                    <div id="winnerAnnouncement" style="margin-top: 20px; padding: 15px; background: #e8f6f3; border-radius: 8px;"></div>
                </div>
                <div id="noResults">
                    <p>–°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã!</p>
                    <div id="communityStats">
                        <p><strong>–õ–∏–¥–µ—Ä—ã –ø–æ –≤–µ—Ä—Å–∏–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞:</strong></p>
                        <ol id="communityTop">
                            <li>–ó–∞–≥—Ä—É–∑–∫–∞...</li>
                        </ol>
                    </div>
                    <button id="viewAllBtn" style="width: 100%; margin-top: 15px;">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å—Ç–∞–≤–∫–∏</button>
                </div>
            </div>
        </div>
        
        <div class="footer">
            ‚ö†Ô∏è –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –∏–≥—Ä–∞ –¥–ª—è —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∏–º 31.12.2026!<br>
            <span id="userCount">–ò–≥—Ä–∞—é—Ç: 1 —á–µ–ª–æ–≤–µ–∫</span>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ –≤—Å–µ–º–∏ —Å—Ç–∞–≤–∫–∞–º–∏ -->
    <div id="allBetsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>–í—Å–µ —Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</h2>
            <div id="allBetsList" class="community-list">
                –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>
        </div>
    </div>

    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø SUPABASE ==========
        // –í–ê–®–ò –ö–õ–Æ–ß–ò SUPABASE
        const SUPABASE_URL = 'https://emsdxguafvggifztgeks.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_hhEWBsXgWr_TTC9rFp7Qfg_SfuD6bYl';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // –î–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        const people = [
            "–ü–æ–¥–≤–∞–ª–∫–æ–≤–∞", "–°–∞–ø—å—è–Ω–∞—è", "–ü–æ–ø–æ–≤", "–ë–∞–ª—ã–∫–∏–Ω–∞", "–ë–∏–ª–∏—á–µ–Ω–∫–æ", 
            "–ö—É–ª–∏–∫–æ–≤", "–î–µ–≥—Ç–µ—Ä–µ–≤–∞", "–¢—è–≥–∏–Ω–∞", "–ö–æ—Ä–æ–ª–µ–≤–∞", "–ñ–∏–ª–∫–æ", 
            "–¢—É—Ä–∫–∏–Ω–∞", "–ë—É—Ä–∫–æ–≤–∞", "–Æ—Ä—á–∏—Ö–∏–Ω–∞"
        ];

        // –ü—Ä–æ–≥–Ω–æ–∑ AI
        const aiPredictions = {
            "–ü–æ–¥–≤–∞–ª–∫–æ–≤–∞": 6, "–°–∞–ø—å—è–Ω–∞—è": 7, "–ü–æ–ø–æ–≤": 3, "–ë–∞–ª—ã–∫–∏–Ω–∞": 4,
            "–ë–∏–ª–∏—á–µ–Ω–∫–æ": 12, "–ö—É–ª–∏–∫–æ–≤": 10, "–î–µ–≥—Ç–µ—Ä–µ–≤–∞": 8, "–¢—è–≥–∏–Ω–∞": 7,
            "–ö–æ—Ä–æ–ª–µ–≤–∞": 7, "–ñ–∏–ª–∫–æ": 15, "–¢—É—Ä–∫–∏–Ω–∞": 9, "–ë—É—Ä–∫–æ–≤–∞": 8, "–Æ—Ä—á–∏—Ö–∏–Ω–∞": 4
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let userBets = {};
        let userName = '';
        let userId = '';
        let leaderboardData = [];
        let communityStats = {
            totalBets: 0,
            topCandidate: '',
            candidateStats: {},
            userCount: 0
        };

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        async function init() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞–≤–æ–∫
            const savedBets = localStorage.getItem('tot_user_bets');
            if (savedBets) {
                userBets = JSON.parse(savedBets);
            } else {
                people.forEach(person => userBets[person] = 0);
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            userName = localStorage.getItem('tot_user_name');
            if (!userName) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram Web App
                if (window.Telegram?.WebApp) {
                    const tg = window.Telegram.WebApp;
                    const user = tg.initDataUnsafe?.user;
                    if (user) {
                        userName = user.first_name || user.username || 'Telegram User';
                        userId = `tg_${user.id}`;
                    }
                }
                
                if (!userName) {
                    userName = prompt("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤:", 
                                    "–ò–≥—Ä–æ–∫_" + Math.floor(Math.random() * 1000));
                }
                
                if (userName) localStorage.setItem('tot_user_name', userName);
            }
            
            // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç
            if (!userId) {
                userId = localStorage.getItem('tot_user_id');
                if (!userId) {
                    userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('tot_user_id', userId);
                }
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App (–µ—Å–ª–∏ –µ—Å—Ç—å)
            if (window.Telegram?.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.expand();
                tg.enableClosingConfirmation();
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É
                if (tg.colorScheme === 'dark') {
                    document.body.style.background = '#1e1e1e';
                    document.querySelector('.container').style.background = '#2d3436';
                    document.querySelector('.container').style.color = '#ffffff';
                }
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            await loadRealStats();
            renderBettingArea();
            updateTokensLeft();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å—Ç–∞–≤–∫–∏
            const usedTokens = Object.values(userBets).reduce((a, b) => a + b, 0);
            if (usedTokens > 0) {
                document.getElementById('saveBtn').classList.remove('hidden');
                document.getElementById('shareBtn').classList.remove('hidden');
            }
            
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        }

        // ========== –†–ê–ë–û–¢–ê –° –ë–ê–ó–û–ô –î–ê–ù–ù–´–• ==========

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadRealStats() {
            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ Supabase...');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Å—Ç–∞–≤–∫–∏
                const { data: bets, error: betsError } = await supabase
                    .from('bets')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (betsError) throw betsError;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
                const { data: candidateStats, error: statsError } = await supabase
                    .from('candidate_stats')
                    .select('*');
                
                if (statsError) throw statsError;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const { data: globalStats, error: globalError } = await supabase
                    .from('global_stats')
                    .select('*')
                    .limit(1);
                
                if (globalError) throw globalError;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
                communityStats.totalBets = bets?.length || 0;
                communityStats.userCount = globalStats?.[0]?.active_users || 1;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                document.getElementById('realTotalBets').textContent = communityStats.totalBets;
                document.getElementById('totalBets').textContent = communityStats.totalBets;
                document.getElementById('userCount').textContent = `–ò–≥—Ä–∞—é—Ç: ${communityStats.userCount} —á–µ–ª–æ–≤–µ–∫`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
                communityStats.candidateStats = {};
                if (candidateStats) {
                    candidateStats.forEach(stat => {
                        communityStats.candidateStats[stat.candidate_name] = stat.average_percentage || 0;
                    });
                }
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ª–∏–¥–µ—Ä–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
                await calculateTopCandidate(bets);
                
                // –°—Ç—Ä–æ–∏–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
                await buildLeaderboard(bets);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
                updateCommunityUI();
                
                console.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                showNotification('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase.');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                showDemoData();
            }
        }

        // –†–∞—Å—á–µ—Ç –ª–∏–¥–µ—Ä–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
        async function calculateTopCandidate(bets) {
            if (!bets || bets.length === 0) {
                communityStats.topCandidate = "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö";
                return;
            }
            
            // –°—á–∏—Ç–∞–µ–º –≥–æ–ª–æ—Å–∞ –∑–∞ –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ (–ø–æ top_choice)
            const candidateVotes = {};
            bets.forEach(bet => {
                if (bet.top_choice) {
                    candidateVotes[bet.top_choice] = (candidateVotes[bet.top_choice] || 0) + 1;
                }
            });
            
            // –ù–∞—Ö–æ–¥–∏–º –ª–∏–¥–µ—Ä–∞
            let topCandidate = '';
            let maxVotes = 0;
            Object.keys(candidateVotes).forEach(candidate => {
                if (candidateVotes[candidate] > maxVotes) {
                    maxVotes = candidateVotes[candidate];
                    topCandidate = candidate;
                }
            });
            
            communityStats.topCandidate = topCandidate || "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö";
            document.getElementById('topCandidate').textContent = topCandidate || "-";
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        async function saveBetToDatabase() {
            const usedTokens = Object.values(userBets).reduce((a, b) => a + b, 0);
            
            if (usedTokens !== 100) {
                alert("–°–Ω–∞—á–∞–ª–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤—Å–µ 100 –∂–µ—Ç–æ–Ω–æ–≤!");
                return;
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–ª–∞–≤–Ω—ã–π –≤—ã–±–æ—Ä (–∫–∞–Ω–¥–∏–¥–∞—Ç —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–≤–∫–æ–π)
            let topChoice = '';
            let maxBet = 0;
            Object.keys(userBets).forEach(person => {
                if (userBets[person] > maxBet) {
                    maxBet = userBets[person];
                    topChoice = person;
                }
            });
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º "–æ—á–∫–∏" –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞
            const score = Math.floor(maxBet * 1.5 + Math.random() * 20);
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å—Ç–∞–≤–∫–∞ –æ—Ç —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const { data: existingBet } = await supabase
                    .from('bets')
                    .select('id')
                    .eq('user_id', userId)
                    .maybeSingle();
                
                const betData = {
                    user_id: userId,
                    user_name: userName,
                    bets: userBets,
                    top_choice: topChoice,
                    total_score: score,
                    created_at: new Date().toISOString()
                };
                
                let result;
                if (existingBet) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç–∞–≤–∫—É
                    result = await supabase
                        .from('bets')
                        .update(betData)
                        .eq('user_id', userId);
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç–∞–≤–∫—É
                    result = await supabase
                        .from('bets')
                        .insert([betData]);
                }
                
                if (result.error) throw result.error;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
                await updateCandidateStats();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                await updateGlobalStats();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                localStorage.setItem('tot_user_bets', JSON.stringify(userBets));
                
                showNotification('‚úÖ –°—Ç–∞–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                setTimeout(() => loadRealStats(), 1000);
                
                return true;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏: ' + error.message);
                return false;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
        async function updateCandidateStats() {
            try {
                const { data: bets } = await supabase
                    .from('bets')
                    .select('bets');
                
                if (!bets || bets.length === 0) return;
                
                // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —Å—á–∏—Ç–∞–µ–º —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                for (const candidate of people) {
                    let total = 0;
                    let count = 0;
                    
                    bets.forEach(bet => {
                        const value = bet.bets[candidate] || 0;
                        if (value > 0) {
                            total += value;
                            count++;
                        }
                    });
                    
                    const average = count > 0 ? (total / count) : 0;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –±–∞–∑–µ
                    await supabase
                        .from('candidate_stats')
                        .update({
                            total_votes: count,
                            average_percentage: Math.round(average * 100) / 100
                        })
                        .eq('candidate_name', candidate);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤:', error);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function updateGlobalStats() {
            try {
                const { data: bets } = await supabase
                    .from('bets')
                    .select('user_id');
                
                const totalBets = bets?.length || 0;
                const uniqueUsers = new Set(bets?.map(b => b.user_id)).size || 0;
                
                await supabase
                    .from('global_stats')
                    .update({
                        total_bets: totalBets,
                        active_users: uniqueUsers,
                        last_updated: new Date().toISOString()
                    })
                    .eq('id', 1);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤
        async function buildLeaderboard(bets) {
            const leaderboardElement = document.getElementById('leaderboard');
            
            if (!bets || bets.length === 0) {
                leaderboardElement.innerHTML = 
                    '<div class="loading">–ï—â–µ –Ω–µ—Ç —Å—Ç–∞–≤–æ–∫. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</div>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ—á–∫–∞–º (score)
            const sortedBets = [...bets].sort((a, b) => b.total_score - a.total_score);
            leaderboardData = sortedBets;
            
            let html = '';
            let myPosition = 0;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 15 –ø–æ–∑–∏—Ü–∏—è–º–∏
            const displayBets = sortedBets.slice(0, 15);
            
            displayBets.forEach((bet, index) => {
                const isMe = bet.user_id === userId;
                const rankClass = index === 0 ? 'rank-1' : 
                                index === 1 ? 'rank-2' : 
                                index === 2 ? 'rank-3' : '';
                
                if (isMe) myPosition = index + 1;
                
                html += `
                    <div class="leaderboard-item ${isMe ? 'me' : ''}">
                        <div class="rank ${rankClass}">${index + 1}</div>
                        <div class="user-name">${bet.user_name || '–ê–Ω–æ–Ω–∏–º'}</div>
                        <div class="user-bet">${bet.top_choice}: ${bet.bets ? (bet.bets[bet.top_choice] || 0) : 0}%</div>
                    </div>
                `;
            });
            
            leaderboardElement.innerHTML = html;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–≤–æ—é –ø–æ–∑–∏—Ü–∏—é
            if (myPosition > 0) {
                document.getElementById('yourPosition').textContent = myPosition;
            } else if (Object.values(userBets).some(bet => bet > 0)) {
                document.getElementById('yourPosition').textContent = "–ù–µ –≤ —Ç–æ–ø-15";
            } else {
                document.getElementById('yourPosition').textContent = "-";
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö" –µ—Å–ª–∏ –µ—Å—Ç—å –µ—â–µ —Å—Ç–∞–≤–∫–∏
            if (sortedBets.length > 15) {
                const showAllBtn = document.createElement('button');
                showAllBtn.textContent = `–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ (${sortedBets.length})`;
                showAllBtn.style.cssText = 'width: 100%; margin-top: 10px; padding: 8px; background: #ecf0f1; border: none; border-radius: 5px; cursor: pointer;';
                showAllBtn.onclick = () => openModal();
                leaderboardElement.appendChild(showAllBtn);
            }
        }

        // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function showDemoData() {
            communityStats.totalBets = 5;
            communityStats.topCandidate = "–ñ–∏–ª–∫–æ";
            communityStats.userCount = 5;
            
            document.getElementById('realTotalBets').textContent = '5';
            document.getElementById('totalBets').textContent = '5';
            document.getElementById('topCandidate').textContent = '–ñ–∏–ª–∫–æ';
            document.getElementById('userCount').textContent = '–ò–≥—Ä–∞—é—Ç: 5 —á–µ–ª–æ–≤–µ–∫';
            
            // –î–µ–º–æ —Ç–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤
            const demoLeaderboard = [
                { user_name: '–ê–ª–µ–∫—Å–µ–π', top_choice: '–ñ–∏–ª–∫–æ', bets: { '–ñ–∏–ª–∫–æ': 25 } },
                { user_name: '–ú–∞—Ä–∏—è', top_choice: '–ë–∏–ª–∏—á–µ–Ω–∫–æ', bets: { '–ë–∏–ª–∏—á–µ–Ω–∫–æ': 20 } },
                { user_name: '–î–º–∏—Ç—Ä–∏–π', top_choice: '–ö—É–ª–∏–∫–æ–≤', bets: { '–ö—É–ª–∏–∫–æ–≤': 18 } }
            ];
            
            let html = '';
            demoLeaderboard.forEach((bet, index) => {
                html += `
                    <div class="leaderboard-item">
                        <div class="rank ${index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : 'rank-3'}">${index + 1}</div>
                        <div class="user-name">${bet.user_name}</div>
                        <div class="user-bet">${bet.top_choice}: ${bet.bets[bet.top_choice]}%</div>
                    </div>
                `;
            });
            
            document.getElementById('leaderboard').innerHTML = html;
        }

        // ========== –§–£–ù–ö–¶–ò–ò UI ==========

        function renderBettingArea() {
            const bettingArea = document.getElementById('bettingArea');
            bettingArea.innerHTML = '';
            
            people.forEach(person => {
                const communityAvg = communityStats.candidateStats?.[person] || 0;
                
                const row = document.createElement('div');
                row.className = 'person-row';
                
                row.innerHTML = `
                    <div style="flex-grow: 1;">
                        <div class="person-name">${person}</div>
                        <div class="candidate-avg">–°–æ–æ–±—â–µ—Å—Ç–≤–æ: ${communityAvg}%</div>
                    </div>
                    <input type="number" min="0" max="100" value="${userBets[person]}" 
                           class="bet-input" data-person="${person}"
                           oninput="updateBet('${person}', this.value)">
                `;
                
                bettingArea.appendChild(row);
            });
        }

        function updateBet(person, value) {
            const numValue = parseInt(value) || 0;
            const currentTotal = Object.values(userBets).reduce((a, b) => a + b, 0);
            const newTotal = currentTotal - userBets[person] + numValue;
            
            if (newTotal > 100) {
                const available = 100 - (currentTotal - userBets[person]);
                alert(`–ù–µ–ª—å–∑—è –ø–æ—Å—Ç–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ 100 –∂–µ—Ç–æ–Ω–æ–≤! –î–æ—Å—Ç—É–ø–Ω–æ: ${available}`);
                const input = document.querySelector(`[data-person="${person}"]`);
                input.value = userBets[person];
                return;
            }
            
            userBets[person] = numValue < 0 ? 0 : numValue;
            updateTokensLeft();
            
            document.getElementById('saveBtn').classList.remove('hidden');
            document.getElementById('shareBtn').classList.remove('hidden');
        }

        function updateTokensLeft() {
            const usedTokens = Object.values(userBets).reduce((a, b) => a + b, 0);
            const totalTokens = 100 - usedTokens;
            document.getElementById('tokensLeft').textContent = totalTokens;
            
            const tokenElement = document.getElementById('tokensLeft');
            tokenElement.style.color = totalTokens < 10 ? '#e74c3c' : 'white';
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #2ecc71;
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            `;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        function updateCommunityUI() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ø —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
            const communityTop = document.getElementById('communityTop');
            if (communityStats.candidateStats) {
                const sortedCandidates = Object.entries(communityStats.candidateStats)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3);
                
                communityTop.innerHTML = sortedCandidates
                    .map(([name, percentage], i) => 
                        `<li>${name}: ${percentage}%</li>`)
                    .join('');
            }
        }

        function showResults() {
            const usedTokens = Object.values(userBets).reduce((a, b) => a + b, 0);
            
            if (usedTokens !== 100) {
                alert(`–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤—Å–µ 100 –∂–µ—Ç–æ–Ω–æ–≤! –í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ ${usedTokens} –∏–∑ 100.`);
                return;
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            let maxBet = 0;
            let winners = [];
            
            Object.keys(userBets).forEach(person => {
                if (userBets[person] > maxBet) {
                    maxBet = userBets[person];
                    winners = [person];
                } else if (userBets[person] === maxBet && maxBet > 0) {
                    winners.push(person);
                }
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º
            const sortedPeople = [...people].sort((a, b) => userBets[b] - userBets[a]);
            
            // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '';
            
            sortedPeople.forEach((person, index) => {
                const resultItem = document.createElement('div');
                resultItem.className = `result-item ${winners.includes(person) ? 'winner' : ''}`;
                
                const userBet = userBets[person];
                const aiBet = aiPredictions[person];
                const communityBet = Math.round(communityStats.candidateStats?.[person] || 0);
                
                resultItem.innerHTML = `
                    <div style="flex-grow: 1;">
                        <strong>${index + 1}. ${person}</strong>
                        <div class="prob-bar">
                            <div class="prob-fill" style="width: 0%" data-width="${userBet}"></div>
                        </div>
                    </div>
                    <div style="text-align: right; min-width: 180px;">
                        <div class="your-bet">–í—ã: ${userBet}%</div>
                        <div class="ai-bet">AI: ${aiBet}%</div>
                        <div class="community-bet">–°–æ–æ–±—â–µ—Å—Ç–≤–æ: ${communityBet}%</div>
                    </div>
                `;
                
                resultsList.appendChild(resultItem);
            });
            
            // –ê–Ω–∏–º–∞—Ü–∏—è
            setTimeout(() => {
                document.querySelectorAll('.prob-fill').forEach(fill => {
                    fill.style.width = fill.getAttribute('data-width') + '%';
                });
            }, 100);
            
            // –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            const winnerAnnouncement = document.getElementById('winnerAnnouncement');
            if (winners.length > 0 && maxBet > 0) {
                if (winners.length === 1) {
                    winnerAnnouncement.innerHTML = `
                        <h3>üéâ –ü–æ –≤–∞—à–∏–º —Å—Ç–∞–≤–∫–∞–º –ø–µ—Ä–≤—ã–º —É–≤–æ–ª–∏—Ç—Å—è: <strong>${winners[0]}</strong></h3>
                        <p>AI —Å–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ ${aiPredictions[winners[0]]}%</p>
                        <p>–°–æ–æ–±—â–µ—Å—Ç–≤–æ —Å—Ç–∞–≤–∏—Ç: ${Math.round(communityStats.candidateStats?.[winners[0]] || 0)}%</p>
                    `;
                } else {
                    winnerAnnouncement.innerHTML = `
                        <h3>üéâ –ü–æ –≤–∞—à–∏–º —Å—Ç–∞–≤–∫–∞–º –ø–µ—Ä–≤—ã–º–∏ –º–æ–≥—É—Ç —É–≤–æ–ª–∏—Ç—å—Å—è: <strong>${winners.join(', ')}</strong></h3>
                        <p>–£ –≤–∞—Å –Ω–∏—á—å—è!</p>
                    `;
                }
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('noResults').style.display = 'none';
        }

        function openModal() {
            document.getElementById('allBetsModal').style.display = 'flex';
            loadAllBets();
        }

        function closeModal() {
            document.getElementById('allBetsModal').style.display = 'none';
        }

        async function loadAllBets() {
            try {
                const { data: bets, error } = await supabase
                    .from('bets')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                const allBetsList = document.getElementById('allBetsList');
                
                if (!bets || bets.length === 0) {
                    allBetsList.innerHTML = '<div class="loading">–ï—â–µ –Ω–µ—Ç —Å—Ç–∞–≤–æ–∫</div>';
                    return;
                }
                
                let html = '';
                bets.forEach(bet => {
                    const date = new Date(bet.created_at).toLocaleDateString('ru-RU');
                    html += `
                        <div class="community-item">
                            <div>
                                <strong>${bet.user_name}</strong><br>
                                <small>${date}</small>
                            </div>
                            <div>
                                ${bet.top_choice}: ${bet.bets[bet.top_choice]}%<br>
                                <small>–û—á–∫–∏: ${bet.total_score}</small>
                            </div>
                        </div>
                    `;
                });
                
                allBetsList.innerHTML = html;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å—Ç–∞–≤–æ–∫:', error);
                document.getElementById('allBetsList').innerHTML = 
                    '<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }

        // ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ==========

        document.addEventListener('DOMContentLoaded', () => {
            init();
            
            document.getElementById('placeBet').addEventListener('click', async () => {
                const usedTokens = Object.values(userBets).reduce((a, b) => a + b, 0);
                if (usedTokens !== 100) {
                    alert('–†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤—Å–µ 100 –∂–µ—Ç–æ–Ω–æ–≤!');
                    return;
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞–≤–∫—É
                const saved = await saveBetToDatabase();
                if (saved) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    showResults();
                }
            });
            
            document.getElementById('randomBtn').addEventListener('click', () => {
                people.forEach(person => userBets[person] = 0);
                
                let tokensLeft = 100;
                const shuffledPeople = [...people].sort(() => Math.random() - 0.5);
                
                for (let i = 0; i < shuffledPeople.length - 1; i++) {
                    if (tokensLeft <= 0) break;
                    
                    if (i === shuffledPeople.length - 2) {
                        userBets[shuffledPeople[i]] = tokensLeft;
                        break;
                    }
                    
                    const maxForThisPerson = Math.min(Math.floor(tokensLeft / 2) + 1, tokensLeft);
                    const randomBet = Math.floor(Math.random() * maxForThisPerson);
                    userBets[shuffledPeople[i]] = randomBet;
                    tokensLeft -= randomBet;
                }
                
                renderBettingArea();
                updateTokensLeft();
                document.getElementById('saveBtn').classList.remove('hidden');
                document.getElementById('shareBtn').classList.remove('hidden');
            });
            
            document.getElementById('resetBtn').addEventListener('click', () => {
                if (confirm("–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Å—Ç–∞–≤–∫–∏?")) {
                    people.forEach(person => userBets[person] = 0);
                    renderBettingArea();
                    updateTokensLeft();
                    document.getElementById('results').classList.add('hidden');
                    document.getElementById('noResults').style.display = 'block';
                    document.getElementById('saveBtn').classList.add('hidden');
                    document.getElementById('shareBtn').classList.add('hidden');
                }
            });
            
            document.getElementById('saveBtn').addEventListener('click', saveBetToDatabase);
            
            document.getElementById('shareBtn').addEventListener('click', () => {
                const usedTokens = Object.values(userBets).reduce((a, b) => a + b, 0);
                if (usedTokens !== 100) {
                    alert("–°–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π—Ç–µ –ø–æ–ª–Ω—É—é —Å—Ç–∞–≤–∫—É!");
                    return;
                }
                
                const sorted = [...people].sort((a, b) => userBets[b] - userBets[a]);
                const top3 = sorted.slice(0, 3);
                
                const shareText = `üé∞ –ú–æ–π –ø—Ä–æ–≥–Ω–æ–∑, –∫—Ç–æ —É–≤–æ–ª–∏—Ç—Å—è –≤ 2026:\n\n` +
                                 `ü•á ${top3[0]}: ${userBets[top3[0]]}%\n` +
                                 `ü•à ${top3[1]}: ${userBets[top3[1]]}%\n` +
                                 `ü•â ${top3[2]}: ${userBets[top3[2]]}%\n\n` +
                                 `–í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫: ${communityStats.totalBets}\n` +
                                 `–õ–∏–¥–µ—Ä —Å–æ–æ–±—â–µ—Å—Ç–≤–∞: ${communityStats.topCandidate}\n\n` +
                                 `–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å: ${window.location.href}`;
                
                if (navigator.share) {
                    navigator.share({
                        title: '–ú–æ–π –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è –≤ 2026',
                        text: shareText,
                        url: window.location.href
                    });
                } else if (window.Telegram?.WebApp) {
                    window.Telegram.WebApp.sendData(JSON.stringify({
                        action: 'share',
                        text: shareText
                    }));
                } else {
                    navigator.clipboard.writeText(shareText);
                    showNotification('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã!');
                }
            });
            
            document.getElementById('viewAllBtn').addEventListener('click', openModal);
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('allBetsModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
